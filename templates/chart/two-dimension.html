{% extends 'layout.html' %}
{% block body %}
    <div class="ui segment">
        <form>
            <select class="ui selection dropdown">
                <option>default</option>
                <option>xiaoya</option>
                <option>daya</option>
            </select>
            variables:
            <select class="ui selection dropdown">
                <option>begin_time</option>
                <option>end_time</option>
            </select>
            <a class="" id="test-query">
                <li class="ui icon layout"></li>
                test query</a>
            <textarea class="ui segment" id="sql-statement">
                SELECT * FROM xiaoya_crm.profession
            </textarea>

            <div class="ui menu attached top" id="columns">
                <div class="item">brand_id:商户ID</div>
                <div class="item">login_count:登录数量</div>
                <div class="item">total:虚拟列</div>
                <a class="right item">
                    <i class="ui icon add"></i>
                    add column
                </a>
            </div>
            <div class="ui segment attached">
                <select class="ui compact selection dropdown">
                    <option>dimension</option>
                    <option>feature</option>
                </select>
                默认值
                <select class="ui selection dropdown">
                    <option>0</option>
                    <option>nothing</option>
                </select>
                <br/>

                <div class="ui menu">
                    <a class="item">
                        <i class="ui icon add"></i>
                        添加值映射
                    </a>
                    <br/>
                    <a class="item">
                        <i class="ui icon add"></i>
                        关联新字段
                    </a>
                </div>
            </div>
        </form>
    </div>

    <script type="text/javascript">
        $('#test-query').click(function () {
            var sql = $('#sql-statement').val()
            $.ajax('/test_query', {
                data: {query: sql, datasource: 'xiaoya'},
                method: 'POST',
                success: function (data) {
                    console.log(data)
                    for (var i in data.description) {
                        $('#columns').append(' <div class="item">' + data.description[i] + '</div>')
                    }
                }
            })
        })
    </script>
{% endblock %}